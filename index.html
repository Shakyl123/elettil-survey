<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elettil Youth Well-being and Perspectives Survey (EYWPS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .survey-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b; /* slate-800 */
            border-bottom: 2px solid #e2e8f0; /* slate-200 */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .question-block {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8fafc; /* slate-50 */
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .question-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: #334155; /* slate-700 */
            margin-bottom: 0.5rem;
        }
        .question-malayalam {
            font-size: 1rem;
            font-weight: 500;
            color: #64748b; /* slate-500 */
            margin-bottom: 1rem;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1; /* slate-300 */
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6; /* blue-500 */
            box-shadow: 0 0 0 2px #bfdbfe; /* blue-200 */
        }
        .radio-group label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
            text-align: center;
        }
        .radio-group input[type="radio"]:checked + label {
            background-color: #eff6ff; /* blue-50 */
            border-color: #3b82f6; /* blue-500 */
            color: #2563eb; /* blue-600 */
            font-weight: 600;
        }
        .likert-scale {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
        }
        .priority-total {
            font-size: 1.25rem;
            font-weight: 700;
            transition: color 0.3s;
        }
        .priority-valid {
            color: #16a34a; /* green-600 */
        }
        .priority-invalid {
            color: #dc2626; /* red-600 */
        }
        .submit-btn {
            width: 100%;
            padding: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            background-color: #2563eb; /* blue-600 */
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .submit-btn:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        .submit-btn:disabled {
            background-color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
        }
        .required-asterisk::after {
            content: ' *';
            color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body>

    <div class="survey-container">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Elettil Youth Well-being and Perspectives Survey (EYWPS)</h1>
            <p class="text-xl font-semibold text-slate-600 mt-2">എലേറ്റിൽ യുവജന ക്ഷേമവും കാഴ്ചപ്പാടുകളും സർവേ (EYWPS)</p>
        </div>

        <!-- Introduction and Consent -->
        <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg">
            <h2 class="text-xl font-bold text-blue-800 mb-2">ആമുഖവും സമ്മതവും (Introduction and Consent)</h2>
            <p class="text-slate-700 mb-2">
                പ്രിയ സുഹൃത്തേ/സഹോദരാ, നമ്മുടെ എലേറ്റിൽ സമൂഹത്തിലെ യുവജനങ്ങളുടെ കാഴ്ചപ്പാടുകൾ, ക്ഷേമം, വെല്ലുവിളികൾ എന്നിവ നന്നായി മനസ്സിലാക്കുന്നതിനാണ് ഞങ്ങൾ ഈ പഠനം നടത്തുന്നത്. നിങ്ങളുടെ സത്യസന്ധമായ പങ്കാളിത്തം വളരെ വിലപ്പെട്ടതാണ്, മികച്ച സാമൂഹിക പിന്തുണ വികസിപ്പിക്കാൻ ഇത് സഹായിക്കും. ഈ സർവേ പൂർണ്ണമായും അജ്ഞാതമാണ്; ദയവായി നിങ്ങളുടെ പേര് എഴുതരുത്. എല്ലാ വിവരങ്ങളും കർശനമായി രഹസ്യമായി സൂക്ഷിക്കുന്നതാണ്. ഇതിൽ പങ്കെടുക്കുന്നത് പൂർണ്ണമായും നിങ്ങളുടെ ഇഷ്ടപ്രകാരമാണ്. നിങ്ങളുടെ വിലയേറിയ സമയത്തിന് നന്ദി.
            </p>
            <label class="flex items-center space-x-3 p-3 mt-4 bg-white rounded-md cursor-pointer border hover:bg-slate-50">
                <input type="checkbox" id="consent" name="consent" class="h-5 w-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500" required>
                <span class="font-semibold text-slate-800 required-asterisk">I have read the above information and I agree to participate. (മുകളിലുള്ള വിവരങ്ങൾ ഞാൻ വായിച്ചു, പങ്കെടുക്കാൻ ഞാൻ സമ്മതിക്കുന്നു.)</span>
            </label>
        </div>

        <form id="surveyForm" class="space-y-10">
            <!-- Part A: General Information -->
            <fieldset>
                <legend class="section-title">Part A: General Information (പൊതുവായ വിവരങ്ങൾ)</legend>
                <div class="space-y-6">
                    <div class="question-block">
                        <label for="age" class="question-text required-asterisk">1. Age (പ്രായം)</label>
                        <input type="number" id="age" name="age" class="input-field" min="15" max="99" required>
                    </div>
                    <div class="question-block">
                        <p class="question-text required-asterisk">2. Gender (ലിംഗം)</p>
                        <div class="radio-group grid grid-cols-2 gap-4 mt-2">
                            <input type="radio" id="male" name="gender" value="male" class="hidden" required><label for="male">Male (പുരുഷൻ)</label>
                            <input type="radio" id="female" name="gender" value="female" class="hidden"><label for="female">Female (സ്ത്രീ)</label>
                        </div>
                    </div>
                    <div class="question-block">
                        <p class="question-text required-asterisk">3. Current Status (ഇപ്പോഴത്തെ അവസ്ഥ)</p>
                        <div class="radio-group grid grid-cols-2 md:grid-cols-4 gap-4 mt-2">
                            <input type="radio" id="school" name="status" value="school" class="hidden" required><label for="school">School Student</label>
                            <input type="radio" id="college" name="status" value="college" class="hidden"><label for="college">College Student</label>
                            <input type="radio" id="working" name="status" value="working" class="hidden"><label for="working">Working</label>
                            <input type="radio" id="not_working" name="status" value="not_working" class="hidden"><label for="not_working">Not Working</label>
                        </div>
                    </div>
                     <div class="question-block">
                        <label for="class_year" class="question-text required-asterisk">4. If you are a student, what is your current class/year? (നിങ്ങൾ വിദ്യാർത്ഥിയാണെങ്കിൽ, ഏത് ക്ലാസ്സിൽ/വർഷം?)</label>
                        <input type="text" id="class_year" name="class_year" class="input-field" required>
                    </div>
                    <div class="question-block">
                        <label for="madrassa_level" class="question-text">5. If you have completed Madrassa education and are below 25, which class/level did you complete?</label>
                        <p class="question-malayalam">നിങ്ങൾ 25 വയസ്സിൽ താഴെയുള്ളതും മദ്രസ വിദ്യാഭ്യാസം പൂർത്തിയാക്കിയ ആളുമാണെങ്കിൽ, ഏത് ക്ലാസ്/തലം വരെ പൂർത്തിയാക്കി?</p>
                        <input type="text" id="madrassa_level" name="madrassa_level" class="input-field">
                    </div>
                </div>
            </fieldset>

            <!-- Part B: Perspectives -->
            <fieldset>
                <legend class="section-title">Part B: Personal and Community Perspectives (വ്യക്തിപരവും സാമൂഹികവുമായ കാഴ്ചപ്പാടുകൾ)</legend>
                
                <!-- Section B1: Priority Allocation Task -->
                <div class="question-block bg-yellow-50 border-yellow-200">
                    <h3 class="question-text text-lg font-bold text-yellow-900 required-asterisk">Section B1: Priority Allocation Task</h3>
                    <p class="question-malayalam">Imagine you have <strong>100 "Priority Points"</strong> to represent what is most important to you. Please distribute these 100 points among the five areas below. <strong>The total must add up to exactly 100.</strong></p>
                    <p class="question-malayalam">നിങ്ങളുടെ കയ്യിൽ <strong>100 "മുൻഗണനാ പോയിന്റുകൾ"</strong> ഉണ്ടെന്ന് സങ്കൽപ്പിക്കുക. ഈ 100 പോയിന്റുകൾ താഴെ പറയുന്ന അഞ്ച് മേഖലകൾക്കായി വിഭജിച്ച് നൽകുക. <strong>ആകെ പോയിന്റുകൾ കൃത്യം 100 ആയിരിക്കണം.</strong></p>
                    <div id="priority-task" class="space-y-4 mt-4">
                        <div>
                            <label class="font-semibold text-slate-700">6. Fulfilling my family's expectations and ensuring their happiness.</label>
                            <p class="text-sm text-slate-500 mb-1">എന്റെ കുടുംബത്തിന്റെ പ്രതീക്ഷകൾ നിറവേറ്റുന്നതും അവരുടെ സന്തോഷം ഉറപ്പാക്കുന്നതും.</p>
                            <input type="number" name="priority_family" class="input-field priority-input" min="0" max="100" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">7. Maintaining a good name and respected position within my local community and religion.</label>
                            <p class="text-sm text-slate-500 mb-1">എന്റെ പ്രാദേശിക സമൂഹത്തിലും മതത്തിലും നല്ല പേര് നിലനിർത്തുന്നത്.</p>
                            <input type="number" name="priority_community" class="input-field priority-input" min="0" max="100" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">8. Spending quality time with my close friends and being an accepted part of the group.</label>
                            <p class="text-sm text-slate-500 mb-1">എന്റെ അടുത്ത സുഹൃത്തുക്കളോടൊപ്പം നല്ല സമയം ചെലവഴിക്കുന്നതും അവരുമായി ചേരുന്നത്.</p>
                            <input type="number" name="priority_friends" class="input-field priority-input" min="0" max="100" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">9. Exploring my own personal interests, goals, and developing my unique personality.</label>
                            <p class="text-sm text-slate-500 mb-1">എന്റെ സ്വന്തം താൽപ്പര്യങ്ങൾ, ലക്ഷ്യങ്ങൾ, ഹോബികൾ എന്നിവ കണ്ടെത്തുന്നത്.</p>
                            <input type="number" name="priority_self" class="input-field priority-input" min="0" max="100" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">10. Building and maintaining my image and presence on social media.</label>
                            <p class="text-sm text-slate-500 mb-1">എൻ്റെ ഓൺലൈൻ ഇമേജും സോഷ്യൽ മീഡിയയിലെ സ്ഥാനവും കെട്ടിപ്പടുക്കുന്നത്.</p>
                            <input type="number" name="priority_social_media" class="input-field priority-input" min="0" max="100" required>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-white rounded-md text-center">
                        <span class="text-slate-600 font-semibold">TOTAL (ആകെ):</span>
                        <span id="priority-total" class="priority-total priority-invalid">0 / 100</span>
                    </div>
                </div>

                <!-- Section B2: Personal Beliefs -->
                 <div class="question-block mt-6">
                    <h3 class="question-text text-lg font-bold">Section B2: Personal Beliefs</h3>
                    <div class="space-y-6 mt-4">
                        <div>
                            <p class="question-text required-asterisk">11. For me, being able to make my own choices about my life and express my own personality is a very important value.</p>
                            <p class="question-malayalam">എന്നെ സംബന്ധിച്ചിടത്തോളം, എന്റെ ജീവിതത്തെക്കുറിച്ച് സ്വന്തമായി തീരുമാനങ്ങൾ എടുക്കാനും എന്റെ വ്യക്തിത്വം പ്രകടിപ്പിക്കാനും കഴിയുന്നത് വളരെ പ്രധാനപ്പെട്ട ഒരു മൂല്യമാണ്.</p>
                            <div class="likert-scale radio-group">
                                <input type="radio" id="b1_1" name="belief_individualism" value="1" class="hidden" required><label for="b1_1">Strongly Disagree</label>
                                <input type="radio" id="b1_2" name="belief_individualism" value="2" class="hidden"><label for="b1_2">Disagree</label>
                                <input type="radio" id="b1_3" name="belief_individualism" value="3" class="hidden"><label for="b1_3">Neutral</label>
                                <input type="radio" id="b1_4" name="belief_individualism" value="4" class="hidden"><label for="b1_4">Agree</label>
                                <input type="radio" id="b1_5" name="belief_individualism" value="5" class="hidden"><label for="b1_5">Strongly Agree</label>
                            </div>
                        </div>
                        <div>
                            <p class="question-text required-asterisk">12. I believe a person's private social life and their public religious identity can be managed separately.</p>
                            <p class="question-malayalam">ഒരാളുടെ സ്വകാര്യ സാമൂഹിക ജീവിതവും അയാളുടെ പരസ്യമായ മതപരമായ വ്യക്തിത്വവും വെവ്വേറെ കൈകാര്യം ചെയ്യാൻ കഴിയുമെന്ന് ഞാൻ വിശ്വസിക്കുന്നു.</p>
                             <div class="likert-scale radio-group">
                                <input type="radio" id="b2_1" name="belief_compartmentalization" value="1" class="hidden" required><label for="b2_1">Strongly Disagree</label>
                                <input type="radio" id="b2_2" name="belief_compartmentalization" value="2" class="hidden"><label for="b2_2">Disagree</label>
                                <input type="radio" id="b2_3" name="belief_compartmentalization" value="3" class="hidden"><label for="b2_3">Neutral</label>
                                <input type="radio" id="b2_4" name="belief_compartmentalization" value="4" class="hidden"><label for="b2_4">Agree</label>
                                <input type="radio" id="b2_5" name="belief_compartmentalization" value="5" class="hidden"><label for="b2_5">Strongly Agree</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section B3: The Single Strategic Question -->
                <div class="question-block mt-6">
                    <p class="question-text required-asterisk">13. The Single Strategic Question:</p>
                    <p class="question-malayalam">Imagine a group of young friends from Elettil are hanging out. One of them takes out a cigarette and says, "Let's try this, just for fun." Which of the following thoughts is the <strong>most likely reason</strong> for a young person in that group to either try it or refuse it? (Choose only ONE option)</p>
                    <p class="question-malayalam">ഒരു കൂട്ടം യുവസുഹൃത്തുക്കൾ സംസാരിച്ചിരിക്കുമ്പോൾ ഒരാൾ ഒരു സിഗരറ്റ് പുറത്തെടുത്ത് പറയുന്നു, "നമുക്കിതൊന്ന് പരീക്ഷിച്ച് നോക്കാം, ഒരു രസത്തിന്." ആ ഗ്രൂപ്പിലുള്ള ഒരു ചെറുപ്പക്കാരൻ അത് പരീക്ഷിക്കുന്നതിനോ നിരസിക്കുന്നതിനോ ഉള്ള ഏറ്റവും സാധ്യതയുള്ള കാരണം എന്തായിരിക്കും? (ഒരൊറ്റ ഓപ്ഷൻ മാത്രം തിരഞ്ഞെടുക്കുക)</p>
                    <div class="radio-group grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <input type="radio" id="sq_a" name="strategic_choice" value="A" class="hidden" required>
                        <label for="sq_a">He would refuse, mainly because he knows it's wrong according to his family and religious values.<br><span class="text-sm text-slate-500">(കുടുംബ, മത മൂല്യങ്ങൾക്ക് എതിരായതിനാൽ നിരസിക്കും.)</span></label>
                        
                        <input type="radio" id="sq_b" name="strategic_choice" value="B" class="hidden">
                        <label for="sq_b">He would probably try it, because he doesn't want to be left out of the friend group.<br><span class="text-sm text-slate-500">(സുഹൃത്തുക്കളുടെ കൂട്ടത്തിൽ നിന്ന് പുറത്താകാൻ ആഗ്രഹിക്കാത്തതിനാൽ പരീക്ഷിക്കും.)</span></label>
                        
                        <input type="radio" id="sq_c" name="strategic_choice" value="C" class="hidden">
                        <label for="sq_c">He would refuse, simply because he is personally not interested and knows it is unhealthy.<br><span class="text-sm text-slate-500">(വ്യക്തിപരമായി താല്പര്യമില്ലാത്തതുകൊണ്ടും ആരോഗ്യത്തിന് ഹാനികരമായതുകൊണ്ടും നിരസിക്കും.)</span></label>
                        
                        <input type="radio" id="sq_d" name="strategic_choice" value="D" class="hidden">
                        <label for="sq_d">He would try it, mostly out of curiosity and for the thrill of doing something seen as "modern."<br><span class="text-sm text-slate-500">(ആധുനികമെന്ന് കരുതുന്ന ഒന്ന് ചെയ്യുന്നതിലെ ജിജ്ഞാസയും ഹരവും കൊണ്ട് പരീക്ഷിക്കും.)</span></label>
                    </div>
                </div>

                <!-- Section B4: Daily Activities -->
                <div class="question-block mt-6">
                     <h3 class="question-text text-lg font-bold required-asterisk">Section B4: Daily Activities</h3>
                     <p class="question-malayalam mt-2">14. On an average day, about how many hours do you spend on these activities (outside of school/work hours)?</p>
                     <div class="space-y-4 mt-4">
                        <div>
                            <label class="font-semibold text-slate-700">Homework or studying (പഠനം)</label>
                            <input type="number" name="hours_study" class="input-field" min="0" max="24" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">Sports (football, cricket, etc.) (പ്രാദേശിക ഗ്രൗണ്ടുകളിലെ സ്പോർട്സ്)</label>
                            <input type="number" name="hours_sports" class="input-field" min="0" max="24" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">Activities with youth organizations (e.g., SSF, SYS, Arts & Sports Clubs) (യുവജന സംഘടനകളിലെ പ്രവർത്തനങ്ങൾ)</label>
                            <input type="number" name="hours_orgs" class="input-field" min="0" max="24" required>
                        </div>
                        <div>
                            <label class="font-semibold text-slate-700">Using social media, gaming, or watching videos online (സോഷ്യൽ മീഡിയ, ഗെയിംസ്, വീഡിയോസ്)</label>
                            <input type="number" name="hours_media" class="input-field" min="0" max="24" required>
                        </div>
                     </div>
                </div>
            </fieldset>

            <!-- Part C: Technology Habits -->
            <fieldset>
                <legend class="section-title">Part C: Habits with Technology (സാങ്കേതികവിദ്യയുമായുള്ള ശീലങ്ങൾ)</legend>
                <div id="part-c-container" class="space-y-6">
                    <!-- Questions 15-19 will be generated here -->
                </div>
            </fieldset>

            <!-- Part D: Substance Experiences -->
            <fieldset>
                <legend class="section-title">Part D: Experiences with Health-Related Substances (ലഹരിവസ്തുക്കളുമായുള്ള അനുഭവങ്ങൾ)</legend>
                <div id="substance-section" class="space-y-6">
                    <!-- Questions will be generated here -->
                </div>
            </fieldset>

             <!-- Part E: Personal Thoughts -->
            <fieldset>
                <legend class="section-title">Part E: Your Personal Thoughts (നിങ്ങളുടെ വ്യക്തിപരമായ ചിന്തകൾ)</legend>
                <div class="space-y-6">
                    <div class="question-block">
                        <label for="challenge_today" class="question-text">24. In your opinion, what is the single biggest challenge for young people in Elettil today?</label>
                        <p class="question-malayalam">നിങ്ങളുടെ അഭിപ്രായത്തിൽ, ഇന്ന് എലേറ്റിൽ യുവജനങ്ങൾ നേരിടുന്ന ഏറ്റവും വലിയ വെല്ലുവിളി എന്താണ്?</p>
                        <textarea id="challenge_today" name="challenge_today" rows="4" class="input-field"></textarea>
                    </div>
                    <div class="question-block">
                        <label for="suggestion_change" class="question-text">25. If you could suggest one change to support the youth in our community, what would it be?</label>
                        <p class="question-malayalam">നമ്മുടെ സമൂഹത്തിലെ യുവജനങ്ങളെ പിന്തുണയ്ക്കാൻ ഒരു മാറ്റം നിർദ്ദേശിക്കാൻ കഴിയുമെങ്കിൽ, അതെന്തായിരിക്കും?</p>
                        <textarea id="suggestion_change" name="suggestion_change" rows="4" class="input-field"></textarea>
                    </div>
                </div>
            </fieldset>

            <div id="submission-message" class="hidden text-center p-4 rounded-md"></div>
            <button type="submit" id="submit-button" class="submit-btn">Submit Survey</button>

        </form>
    </div>

    <script>
        // --- Priority Allocation Task Logic ---
        const priorityInputs = document.querySelectorAll('.priority-input');
        const totalDisplay = document.getElementById('priority-total');

        function updatePriorityTotal() {
            let total = 0;
            priorityInputs.forEach(input => {
                total += Number(input.value) || 0;
            });
            totalDisplay.textContent = `${total} / 100`;
            if (total === 100) {
                totalDisplay.classList.remove('priority-invalid');
                totalDisplay.classList.add('priority-valid');
            } else {
                totalDisplay.classList.remove('priority-valid');
                totalDisplay.classList.add('priority-invalid');
            }
        }
        priorityInputs.forEach(input => input.addEventListener('input', updatePriorityTotal));

        // --- Dynamic Question Generation ---
        function createLikertQuestion(container, questionNumber, questionText, questionMalayalam, name, options, isRequired) {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-block';
            const requiredClass = isRequired ? 'required-asterisk' : '';
            const requiredAttr = isRequired ? 'required' : '';
            
            questionDiv.innerHTML = `
                <p class="question-text ${requiredClass}">${questionNumber}. ${questionText}</p>
                <p class="question-malayalam">${questionMalayalam}</p>
                <div class="likert-scale radio-group">
                    ${options.map((opt, i) => `
                        <input type="radio" id="${name}_${i}" name="${name}" value="${i + 1}" class="hidden" ${i === 0 ? requiredAttr : ''}>
                        <label for="${name}_${i}">${opt}</label>
                    `).join('')}
                </div>
            `;
            container.appendChild(questionDiv);
        }

        // --- Generate Part C Questions ---
        const partCContainer = document.getElementById('part-c-container');
        const techQuestions = [
            { q: "How often do you find that you stay online longer than you intended?", m: "നിങ്ങൾ വിചാരിക്കുന്നതിലും കൂടുതൽ നേരം ഓൺലൈനിൽ ചെലവഴിക്കാറുണ്ടോ?", n: "iat_longer" },
            { q: "How often do you lose sleep due to late-night internet use?", m: "ഇന്റർനെറ്റ് ഉപയോഗം കാരണം രാത്രി ഉറക്കം നഷ്ടപ്പെടാറുണ്ടോ?", n: "iat_sleep" },
            { q: "How often do you prefer the excitement of the internet to spending time with friends in person?", m: "സുഹൃത്തുക്കളോടൊപ്പം നേരിട്ട് സമയം ചെലവഴിക്കുന്നതിനേക്കാൾ ഇന്റർനെറ്റിലെ ആവേശം നിങ്ങൾ ഇഷ്ടപ്പെടാറുണ്ടോ?", n: "iat_prefer" },
            { q: "How often do you feel anxious or irritable when you cannot get online?", m: "ഇന്റർനെറ്റ് ഉപയോഗിക്കാൻ കഴിയാതെ വരുമ്പോൾ നിങ്ങൾക്ക് അസ്വസ്ഥതയോ ദേഷ്യമോ തോന്നാറുണ്ടോ?", n: "iat_anxious" },
            { q: "How often do you find yourself thinking about being online again when you are offline?", m: "ഓഫ്‌ലൈനിലായിരിക്കുമ്പോൾ വീണ്ടും ഓൺ‌ലൈനാകുന്നതിനെക്കുറിച്ച് ചിന്തിക്കാറുണ്ടോ?", n: "iat_thinking" }
        ];
        const techOptions = ['Rarely', 'Occasionally', 'Frequently', 'Often', 'Always'];
        techQuestions.forEach((item, index) => {
            createLikertQuestion(partCContainer, 15 + index, item.q, item.m, item.n, techOptions, true);
        });
        
        // --- Generate Part D Questions and Logic ---
        const partDContainer = document.getElementById('substance-section');
        const substances = [
            { name: "Tobacco products (cigarettes, beedis, pan, vape)", malayalam: "പുകയില ഉൽപ്പന്നങ്ങൾ", key: "tobacco" },
            { name: "Alcoholic beverages (beer, wine, toddy, etc.)", malayalam: "മദ്യം", key: "alcohol" },
            { name: "Cannabis (ganja, charas, hashish)", malayalam: "കഞ്ചാവ്", key: "cannabis" }
        ];

        // Question 20
        const q20Block = document.createElement('div');
        q20Block.className = 'question-block';
        q20Block.innerHTML = `
            <p class="question-text required-asterisk">20. In your entire life, which of the following substances have you ever used? (NON-MEDICAL USE ONLY)</p>
            <p class="question-malayalam">നിങ്ങളുടെ ജീവിതത്തിൽ, താഴെ പറയുന്ന ലഹരിവസ്തുക്കളിൽ ഏതെങ്കിലും എപ്പോഴെങ്കിലും ഉപയോഗിച്ചിട്ടുണ്ടോ? (മെഡിക്കൽ ആവശ്യങ്ങൾക്കല്ലാതെ)</p>
            <div id="substance-ever-used" class="space-y-2 mt-2">
                ${substances.map(s => `
                    <div class="flex justify-between items-center p-2 bg-white rounded-md">
                        <span class="font-medium text-slate-700">${s.name} <span class="text-slate-500">(${s.malayalam})</span></span>
                        <div class="radio-group flex gap-2">
                            <input type="radio" id="${s.key}_yes" name="ever_used_${s.key}" value="yes" class="hidden substance-ever-radio" required><label for="${s.key}_yes" class="px-4 py-1">Yes</label>
                            <input type="radio" id="${s.key}_no" name="ever_used_${s.key}" value="no" class="hidden substance-ever-radio"><label for="${s.key}_no" class="px-4 py-1">No</label>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        partDContainer.appendChild(q20Block);

        // Question 21
        const q21Block = document.createElement('div');
        q21Block.id = 'q21-block';
        q21Block.className = 'question-block hidden';
        q21Block.innerHTML = `
            <p class="question-text required-asterisk">21. In the PAST 3 MONTHS, how often have you used the substances you mentioned above?</p>
            <p class="question-malayalam">കഴിഞ്ഞ 3 മാസത്തിനുള്ളിൽ, നിങ്ങൾ മുകളിൽ സൂചിപ്പിച്ച വസ്തുക്കൾ എത്ര തവണ ഉപയോഗിച്ചു?</p>
            <div class="space-y-4 mt-2">
                ${substances.map(s => `
                    <div id="freq_${s.key}" class="hidden">
                        <p class="font-semibold text-slate-800">${s.name}</p>
                        <div class="likert-scale radio-group mt-1">
                            <input type="radio" id="freq_${s.key}_1" name="freq_${s.key}" value="1" class="hidden"><label for="freq_${s.key}_1">Never</label>
                            <input type="radio" id="freq_${s.key}_2" name="freq_${s.key}" value="2" class="hidden"><label for="freq_${s.key}_2">Once/Twice</label>
                            <input type="radio" id="freq_${s.key}_3" name="freq_${s.key}" value="3" class="hidden"><label for="freq_${s.key}_3">Monthly</label>
                            <input type="radio" id="freq_${s.key}_4" name="freq_${s.key}" value="4" class="hidden"><label for="freq_${s.key}_4">Weekly</label>
                            <input type="radio" id="freq_${s.key}_5" name="freq_${s.key}" value="5" class="hidden"><label for="freq_${s.key}_5">Daily</label>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        partDContainer.appendChild(q21Block);
        
        // Question 22 & 23
        const q22Block = document.createElement('div');
        q22Block.id = 'q22-block';
        q22Block.className = 'hidden';
        createLikertQuestion(q22Block, 22, "In the past 3 months, how often have you had a strong desire or urge to use any of these substances?", "കഴിഞ്ഞ 3 മാസത്തിനുള്ളിൽ, ഈ വസ്തുക്കൾ ഉപയോഗിക്കാൻ നിങ്ങൾക്ക് എത്രതവണ ശക്തമായ ആഗ്രഹം തോന്നിയിട്ടുണ്ട്?", "urge_to_use", ['Never', 'Once/Twice', 'Monthly', 'Weekly', 'Daily'], true);
        partDContainer.appendChild(q22Block);

        const q23Block = document.createElement('div');
        q23Block.id = 'q23-block';
        q23Block.className = 'hidden';
        createLikertQuestion(q23Block, 23, "Has a friend, relative, or anyone else ever expressed concern about your substance use?", "നിങ്ങളുടെ ലഹരി ഉപയോഗത്തെക്കുറിച്ച് ഒരു സുഹൃത്തോ ബന്ധുവോ മറ്റാരെങ്കിലുമോ എപ്പോഴെങ്കിലും ആശങ്ക പ്രകടിപ്പിച്ചിട്ടുണ്ടോ?", "concern_from_others", ['No, never', 'Yes, but not in past 3 months', 'Yes, in past 3 months'], true);
        partDContainer.appendChild(q23Block);

        // NEW: Follow-up Question 24
        const q24FollowupBlock = document.createElement('div');
        q24FollowupBlock.id = 'q24-followup-block';
        q24FollowupBlock.className = 'question-block hidden';
        q24FollowupBlock.innerHTML = `
            <label for="concern_details" class="question-text">24. If you answered 'Yes', could you briefly describe what happened or what was said?</label>
            <p class="question-malayalam">നിങ്ങൾ 'ഉണ്ട്' എന്നാണ് ഉത്തരം നൽകിയതെങ്കിൽ, എന്ത് സംഭവിച്ചുവെന്നോ എന്ത് പറഞ്ഞുവെന്നോ ചുരുക്കി വിവരിക്കാമോ?</p>
            <textarea id="concern_details" name="concern_details" rows="4" class="input-field"></textarea>
        `;
        partDContainer.appendChild(q24FollowupBlock);


        // --- Logic to show/hide substance questions and manage 'required' attribute ---
        const substanceRadios = document.querySelectorAll('.substance-ever-radio');
        function checkSubstanceUse() {
            let anyYes = false;
            substances.forEach(s => {
                const yesRadio = document.getElementById(`${s.key}_yes`);
                const freqDiv = document.getElementById(`freq_${s.key}`);
                const freqRadios = document.querySelectorAll(`input[name="freq_${s.key}"]`);

                if (yesRadio && yesRadio.checked) {
                    anyYes = true;
                    freqDiv.classList.remove('hidden');
                    freqRadios.forEach(r => r.required = true);
                } else {
                    freqDiv.classList.add('hidden');
                    freqRadios.forEach(r => r.required = false);
                }
            });

            const subsequentQuestions = ['q21-block', 'q22-block', 'q23-block'];
            if (anyYes) {
                subsequentQuestions.forEach(id => {
                    const block = document.getElementById(id);
                    block.classList.remove('hidden');
                    const radios = block.querySelectorAll('input[type="radio"]');
                    radios.forEach(r => r.required = true);
                });
            } else {
                 subsequentQuestions.forEach(id => {
                    const block = document.getElementById(id);
                    block.classList.add('hidden');
                    const radios = block.querySelectorAll('input[type="radio"]');
                    radios.forEach(r => r.required = false);
                });
                document.getElementById('q24-followup-block').classList.add('hidden');
            }
        }
        substanceRadios.forEach(radio => radio.addEventListener('change', checkSubstanceUse));
        
        // NEW: Logic for concern follow-up question
        const concernRadios = document.querySelectorAll('input[name="concern_from_others"]');
        concernRadios.forEach(radio => {
            radio.addEventListener('change', function(e) {
                const followupBlock = document.getElementById('q24-followup-block');
                // Value "2" is "Yes, but not in past 3 months", Value "3" is "Yes, in past 3 months"
                if (e.target.value === '2' || e.target.value === '3') {
                    followupBlock.classList.remove('hidden');
                } else {
                    followupBlock.classList.add('hidden');
                }
            });
        });


        // --- Form Submission Logic with Google Apps Script Integration ---
        const form = document.getElementById('surveyForm');
        const submissionMessage = document.getElementById('submission-message');
        const submitButton = document.getElementById('submit-button');
        const scriptURL = 'https://script.google.com/macros/s/AKfycbx0akxM-eVTdQVGrqYujfY2Rdxd_jK6G9egrfYSaYIkos8CFRVbgO0C9cAw8zbDMurZvA/exec';

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Check for invalid fields
            const firstInvalidField = form.querySelector(':invalid');
            if (firstInvalidField) {
                submissionMessage.textContent = "Please fill out all required fields marked with an asterisk (*).";
                submissionMessage.className = 'block text-center p-4 rounded-md bg-red-100 text-red-700';
                firstInvalidField.closest('.question-block, .mb-8').scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            // Validation for priority task
            let total = 0;
            priorityInputs.forEach(input => { total += Number(input.value) || 0; });
            if (total !== 100) {
                submissionMessage.textContent = "Please ensure the Priority Points add up to exactly 100.";
                submissionMessage.className = 'block text-center p-4 rounded-md bg-red-100 text-red-700';
                totalDisplay.closest('.question-block').scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Disable button and show loading state
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            submissionMessage.className = 'hidden';

            // Submit data to Google Apps Script
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    submissionMessage.textContent = "Thank you for your valuable participation! Your response has been recorded.";
                    submissionMessage.className = 'block text-center p-4 rounded-md bg-green-100 text-green-700';
                    form.reset();
                    updatePriorityTotal(); // Reset display
                    checkSubstanceUse(); // Hide substance sections again
                    window.scrollTo(0, 0);
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    submissionMessage.textContent = "An error occurred while submitting. Please try again.";
                    submissionMessage.className = 'block text-center p-4 rounded-md bg-red-100 text-red-700';
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Survey';
                });
        });

    </script>

</body>
</html>
